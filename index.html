<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unity Rich Text Viewer</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #0a0f1a; /* dark blue-black background */
      color: #f0f0f0;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 20px;
      align-items: start;
    }

    .box {
      background: #1a2233; /* slightly lighter dark box */
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    h2, h3 {
      color: #ffffff;
    }

    * {
  box-sizing: border-box;
}

textarea {
  width: 100%;
  height: 200px;
  font-family: monospace;
  resize: vertical;
  background: #0d1524;
  color: #f0f0f0;
  border: 1px solid #333;
  border-radius: 4px;
  padding: 8px;
}


    .output {
      min-height: 200px;
      border: 1px solid #333;
      padding: 10px;
      border-radius: 6px;
      background: #0d1524;
      white-space: pre-wrap;
      color: #f0f0f0;
    }

    .warning {
      position: relative;
      display: inline-block;
      background: #ffc31d;
      color: black;
      font-weight: bold;
      padding: 5px 8px;
      border-radius: 4px;
      margin-bottom: 10px;
      cursor: help;
      visibility: hidden;
    }

    .warning::after {
      content: attr(data-tooltip);
      visibility: hidden;
      width: max-content;
      max-width: 250px;
      background: #333;
      color: #fff;
      text-align: left;
      border-radius: 5px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      left: 110%;
      top: 50%;
      transform: translateY(-50%);
      white-space: normal;
    }

    .warning:hover::after {
      visibility: visible;
    }

    a {
      color: #4aa3ff;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h2>Unity Rich Text Previewer</h2>

  <!-- Warning box -->
  <div id="warning" class="warning" data-tooltip="">âš </div>

  <div class="container">
    <div class="box">
      <h3>Input (Unity Rich Text)</h3>
      <textarea id="inputText" placeholder='Example: <color=lime>Hello world!</color>'></textarea>
    </div>
    <div class="box">
      <h3>Output (Rendered)</h3>
      <div id="output" class="output"></div>
    </div>
  </div>
  <h3>Supported Tags: "b", "i", "u", "s", "color", "size", "align", "link", "sub", "sup"</h3>

  <script>
    const input = document.getElementById("inputText");
    const output = document.getElementById("output");
    const warning = document.getElementById("warning");

    function parseURT(text) {
      return text
        .replace(/<b>([\s\S]*?)<\/b>/gi, "<strong>$1</strong>")
        .replace(/<i>([\s\S]*?)<\/i>/gi, "<em>$1</em>")
        .replace(/<u>([\s\S]*?)<\/u>/gi, "<u>$1</u>")
        .replace(/<s>([\s\S]*?)<\/s>/gi, "<del>$1</del>")
        .replace(/<color=(.+?)>([\s\S]*?)<\/color>/gi, "<span style='color:$1'>$2</span>")
        .replace(/<size=(\d+)>([\s\S]*?)<\/size>/gi, "<span style='font-size:$1px'>$2</span>")
        .replace(/<align=(left|center|right)>([\s\S]*?)<\/align>/gi, "<div style='text-align:$1'>$2</div>")
        .replace(/<link="(.+?)">([\s\S]*?)<\/link>/gi, "<a href='$1' target='_blank'>$2</a>");
    }

    function checkErrors(text) {
  let issues = [];
  const supportedTags = ["b", "i", "u", "s", "color", "size", "align", "link", "sub", "sup"];
  const tagRegex = /<\/?([a-z]+)(?:=[^>]*)?>/gi;
  let stack = [];
  let match;

  // === Tag matching check ===
  while ((match = tagRegex.exec(text)) !== null) {
    const tag = match[1].toLowerCase();
    const isClosing = match[0].startsWith("</");

    if (!supportedTags.includes(tag)) {
      issues.push(`Unsupported tag <${tag}>.`);
      continue;
    }

    if (!isClosing) {
      stack.push(tag);
    } else {
      if (stack.length === 0 || stack[stack.length - 1] !== tag) {
        issues.push(`Unexpected closing tag </${tag}>.`);
      } else {
        stack.pop();
      }
    }
  }

  if (stack.length > 0) {
    issues.push("Unclosed tag(s): " + stack.join(", "));
  }

  // === Unsupported color check ===
  const allowedColors = [
    "red","green","blue","yellow","black","white","cyan","magenta",
    "gray","grey", "pink", "fuchsia", "aqua", "brown", "lightblue", "lime", "maroon", "navy", "olive", "orange", "silver", "teal"
  ];
  const colorRegex = /<color=([^>]+)>/gi;
  let colorMatch;
  while ((colorMatch = colorRegex.exec(text)) !== null) {
    const colorVal = colorMatch[1].toLowerCase();
    const isHex = /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(colorVal);
    if (!allowedColors.includes(colorVal) && !isHex) {
      issues.push(`Unsupported color value: "${colorVal}".`);
    }
  }

  // === Custom forbidden words check ===
  const forbiddenList = [
    // === "Unsupported text.",
  ];
  forbiddenList.forEach(item => {
    if (text.includes(item)) {
      issues.push(`Forbidden text found: "${item}".`);
    }
  });

  return issues;
}


    function updateOutput() {
      const text = input.value;

      output.innerHTML = parseURT(text);

      const errors = checkErrors(text);
      if (errors.length > 0) {
        warning.style.visibility = "visible";
        warning.setAttribute("data-tooltip", errors.join("\n"));
      } else {
        warning.style.visibility = "hidden";
        warning.setAttribute("data-tooltip", "");
      }
    }

    // Update on typing
    input.addEventListener("input", updateOutput);

    // Run once on page load
    updateOutput();
  </script>
</body>
</html>
